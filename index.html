<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Safety Matching Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 20px;
        }
        .emoji-story, .options {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .emoji-story div {
            margin: 0 10px;
            padding: 10px;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        .options {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 tips per row */
            gap: 10px;
            justify-content: center;
            max-width: 800px; /* Limit width for proper layout */
            margin: 0 auto; /* Center grid */
        }
        .dropzone {
            border: 2px dashed #ccc;
            padding: 10px;
            cursor: pointer;
            text-align: center;
        }
        .correct {
            background-color: #d4edda; /* Green for correct match */
        }
        .incorrect {
            background-color: #f99; /* Red for incorrect match */
        }
        .reset {
            background-color: transparent; /* Reset when digit is cleared */
        }
        #penalty-clock {
            font-size: 18px;
            color: red;
            margin-top: 10px;
        }
        #result {
            font-size: 20px;
            color: green;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Emoji Safety Matching Game</h1>
    <p>Drag and drop the emoji story to the correct online safety tip to find the code! Be careful: an incorrect guess will hide the revealed digit and impose a delay before you can try again.</p>

    <div class="emoji-story">
        <div id="emoji1" draggable="true" ondragstart="drag(event)">👀🚫🔗</div>
        <div id="emoji2" draggable="true" ondragstart="drag(event)">🔒💪🔡🔢</div>
        <div id="emoji3" draggable="true" ondragstart="drag(event)">📱🔐2️⃣</div>
        <div id="emoji4" draggable="true" ondragstart="drag(event)">💻🔄📅✅</div>
        <div id="emoji5" draggable="true" ondragstart="drag(event)">🎣🚫📧💳</div>
    </div>

    <div class="options" id="safetyTipsGrid">
        <!-- Safety tips will be randomly distributed here -->
    </div>

    <div id="result"></div>
    <p id="penalty-clock"></p>

    <script>
        let code = ['', '', '', '', '']; // Code: 26359
        let foundMatches = {};
        let completedMatches = 0;
        let delayTimes = { emoji1: 1000, emoji2: 1000, emoji3: 1000, emoji4: 1000, emoji5: 1000 }; // Initial delay
        let delayClockInterval;

        // Array of valid safety tips with matching correct answers
        const safetyTips = [
            { text: "Don’t click suspicious links", emojiId: "emoji1", codeDigit: 2 },
            { text: "Use a strong password", emojiId: "emoji2", codeDigit: 6 },
            { text: "Enable Two-Factor Authentication", emojiId: "emoji3", codeDigit: 3 },
            { text: "Keep software updated", emojiId: "emoji4", codeDigit: 5 },
            { text: "Avoid phishing scams", emojiId: "emoji5", codeDigit: 9 },
            { text: "Log out from shared devices", emojiId: null },
            { text: "Store your passwords in a password manager", emojiId: null },
            { text: "Report online harassment", emojiId: null },
            { text: "Use secure networks", emojiId: null },
            { text: "Be cautious when sharing personal information", emojiId: null }
        ];

        // Shuffle the safety tips array
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Function to initialize the safety tips grid with shuffled safety tips
        function initializeSafetyTips() {
            const safetyTipsGrid = document.getElementById('safetyTipsGrid');
            shuffle(safetyTips); // Randomize the order of safety tips

            safetyTips.forEach(tip => {
                const tipDiv = document.createElement('div');
                tipDiv.classList.add('dropzone');
                tipDiv.innerHTML = tip.text;
                if (tip.emojiId) {
                    tipDiv.setAttribute('ondrop', `drop(event, '${tip.emojiId}', '${tip.text}', ${tip.codeDigit})`);
                    tipDiv.setAttribute('ondragover', 'allowDrop(event)');
                }
                safetyTipsGrid.appendChild(tipDiv);
            });
        }

        initializeSafetyTips();

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
            event.target.classList.add('dragged');
        }

        function drop(event, emojiId, correctMatch, number) {
            event.preventDefault();
            const draggedEmojiId = event.dataTransfer.getData("text");

            // Correct match logic
            if (draggedEmojiId === emojiId && !foundMatches[emojiId]) {
                foundMatches[emojiId] = true;
                code[parseInt(emojiId.replace('emoji', '')) - 1] = number;
                document.getElementById(draggedEmojiId).classList.add('correct'); // Turn green
                completedMatches++;
                updateResult();

                if (completedMatches === 5) {
                    document.getElementById('result').innerHTML = `Success! The final code is: ${code.join('')}`;
                }
            } else {
                // Incorrect match handling
                event.target.classList.add('incorrect'); // Turn red
                document.getElementById('result').innerHTML = "Incorrect match, try again.";
                code[parseInt(emojiId.replace('emoji', '')) - 1] = ''; // Hide the digit
                document.getElementById(draggedEmojiId).classList.remove('correct'); // Remove green
                document.getElementById(draggedEmojiId).classList.add('reset'); // Reset background
                updateResult();
                disableDragFor(emojiId); // Add delay
            }
        }

        function updateResult() {
            document.getElementById('result').innerHTML = `Code so far: ${code.map(d => d || '_').join(' ')}`;
        }

        function disableDragFor(emojiId) {
            const emojiElement = document.getElementById(emojiId);
            emojiElement.setAttribute("draggable", "false");

            let delay = delayTimes[emojiId] / 1000; // Convert milliseconds to seconds
            document.getElementById('penalty-clock').innerHTML = `Penalty: ${delay} seconds remaining...`;

            // Penalty delay clock countdown
            clearInterval(delayClockInterval);
            delayClockInterval = setInterval(() => {
                delay--;
                if (delay <= 0) {
                    clearInterval(delayClockInterval);
                    emojiElement.setAttribute("draggable", "true");
                    document.getElementById('penalty-clock').innerHTML = '';
                } else {
                    document.getElementById('penalty-clock').innerHTML = `Penalty: ${delay} seconds remaining...`;
                }
            }, 1000);

            delayTimes[emojiId] += 1000; // Increase delay by 1 second for next incorrect guess
        }
    </script>
</body>
</html>
